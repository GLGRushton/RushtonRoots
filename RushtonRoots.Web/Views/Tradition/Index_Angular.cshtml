@{
    ViewData["Title"] = "Family Traditions";
    
    // ViewBag data populated by TraditionViewController for noscript fallback
    // Angular component fetches data from API endpoints directly
    var traditions = ViewBag.Traditions ?? new List<object>();
    var categories = ViewBag.Categories ?? new List<object>();
    var featuredTraditions = ViewBag.FeaturedTraditions ?? new List<object>();
    var recentTraditions = ViewBag.RecentTraditions ?? new List<object>();
    var canEdit = ViewBag.CanEdit ?? false;
    
    // Query parameters for routing
    var traditionId = Context.Request.Query["traditionId"].ToString();
    var slug = Context.Request.Query["slug"].ToString();
    var category = Context.Request.Query["category"].ToString();
    var frequency = Context.Request.Query["frequency"].ToString();
}

<!-- Angular Component -->
<app-tradition-index
    traditions="@Html.Raw(System.Text.Json.JsonSerializer.Serialize(traditions))"
    categories="@Html.Raw(System.Text.Json.JsonSerializer.Serialize(categories))"
    featured-traditions="@Html.Raw(System.Text.Json.JsonSerializer.Serialize(featuredTraditions))"
    recent-traditions="@Html.Raw(System.Text.Json.JsonSerializer.Serialize(recentTraditions))"
    can-edit="@canEdit.ToString().ToLower()"
    tradition-id="@traditionId"
    slug="@slug"
    category-filter="@category"
    frequency-filter="@frequency">
</app-tradition-index>

<!-- Noscript Fallback -->
<noscript>
    <div class="noscript-fallback">
        <h1>Family Traditions</h1>
        <p class="alert alert-warning">
            <strong>JavaScript Required:</strong> This page requires JavaScript to display the tradition interface.
            Please enable JavaScript in your browser settings.
        </p>
        
        @if (traditions is IEnumerable<object> traditionsList && traditionsList.Any())
        {
            <div class="tradition-list">
                <h2>Available Traditions</h2>
                <ul>
                    @foreach (dynamic tradition in traditionsList)
                    {
                        <li>
                            <strong>@(tradition?.Title ?? "Untitled")</strong>
                            @{
                                var description = tradition?.Description;
                                if (description != null && !string.IsNullOrEmpty(description))
                                {
                                    <p>@description</p>
                                }
                            }
                            <p>
                                <small>
                                    Frequency: @(tradition?.Frequency ?? "Unknown")
                                    @if (tradition?.StartedYear != null)
                                    {
                                        @: | Started: @tradition.StartedYear
                                    }
                                    @{
                                        var categoryName = tradition?.CategoryName;
                                        if (categoryName != null && !string.IsNullOrEmpty(categoryName))
                                        {
                                            @: | Category: @categoryName
                                        }
                                    }
                                </small>
                            </p>
                        </li>
                    }
                </ul>
            </div>
        }
        else
        {
            <p>No traditions available at this time.</p>
        }
    </div>
</noscript>

@section Scripts {
    <!-- Angular runtime scripts (loaded from wwwroot after build) -->
    <script src="~/runtime.js" asp-append-version="true"></script>
    <script src="~/polyfills.js" asp-append-version="true"></script>
    <script src="~/main.js" asp-append-version="true"></script>
}

<style>
    .noscript-fallback {
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
    }
    
    .noscript-fallback .tradition-list {
        background: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .noscript-fallback ul {
        list-style: none;
        padding: 0;
    }
    
    .noscript-fallback li {
        padding: 16px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .noscript-fallback li:last-child {
        border-bottom: none;
    }
    
    .noscript-fallback strong {
        color: #d32f2f;
        font-size: 1.25rem;
        display: block;
        margin-bottom: 8px;
    }
    
    .noscript-fallback p {
        color: #555;
        margin: 8px 0;
    }
    
    .noscript-fallback small {
        color: #999;
    }
</style>
