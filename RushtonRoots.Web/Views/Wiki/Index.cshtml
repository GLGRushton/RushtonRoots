@{
    ViewData["Title"] = "Family Wiki";
}

@section Styles {
    <link rel="stylesheet" href="~/css/wiki.css" asp-append-version="true" />
}

<div class="wiki-page">
    <!-- Determine view mode: if articleId or slug is provided, show article; otherwise show index -->
    @{
        var articleId = Context.Request.Query["articleId"].ToString();
        var articleSlug = Context.Request.Query["slug"].ToString();
        var showArticle = !string.IsNullOrEmpty(articleId) || !string.IsNullOrEmpty(articleSlug);
        
        // Build article attributes for cleaner rendering
        var articleIdAttr = !string.IsNullOrEmpty(articleId) ? $"article-id=\"{articleId}\"" : "";
        var articleSlugAttr = !string.IsNullOrEmpty(articleSlug) ? $"article-slug=\"{articleSlug}\"" : "";
        var articleAttrs = string.Join(" ", new[] { articleIdAttr, articleSlugAttr }.Where(a => !string.IsNullOrEmpty(a)));
    }

    @if (showArticle)
    {
        <!-- Display Wiki Article -->
        <app-wiki-article @Html.Raw(articleAttrs)></app-wiki-article>
        
        <noscript>
            <div class="alert alert-warning">
                <strong>JavaScript Required</strong>
                <p>This wiki article requires JavaScript to display properly. Please enable JavaScript in your browser.</p>
            </div>
        </noscript>
    }
    else
    {
        <!-- Display Wiki Index -->
        <app-wiki-index></app-wiki-index>
        
        <noscript>
            <div class="alert alert-warning">
                <strong>JavaScript Required</strong>
                <p>The wiki knowledge base requires JavaScript to display properly. Please enable JavaScript in your browser.</p>
            </div>
        </noscript>
    }
</div>

@section Scripts {
    <script src="~/runtime.js" asp-append-version="true"></script>
    <script src="~/polyfills.js" asp-append-version="true"></script>
    <script src="~/main.js" asp-append-version="true"></script>
}
