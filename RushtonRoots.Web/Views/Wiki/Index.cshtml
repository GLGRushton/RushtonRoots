@{
    ViewData["Title"] = "Family Wiki";
}

<div class="wiki-container">
    <section class="wiki-header">
        <h1>üìö Family Wiki</h1>
        <p class="tagline">Your family knowledge base</p>
        <div class="description">
            <p>
                Welcome to the Rushton family wiki - a collaborative knowledge repository where we preserve 
                our family's stories, history, and traditions for future generations.
            </p>
        </div>
    </section>

    <section class="wiki-categories">
        <h2>Browse by Category</h2>
        <div id="categories-container" class="categories-grid">
            <p>Loading categories...</p>
        </div>
    </section>

    <section class="wiki-recent">
        <h2>Recently Updated</h2>
        <div id="recent-pages-container">
            <p>Loading recent pages...</p>
        </div>
    </section>

    <section class="wiki-popular-tags">
        <h2>Popular Tags</h2>
        <div id="popular-tags-container">
            <p>Loading popular tags...</p>
        </div>
    </section>
</div>

<style>
    .wiki-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .wiki-header {
        background: white;
        border-radius: 16px;
        padding: 40px;
        margin-bottom: 40px;
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.15);
        border-left: 6px solid #4caf50;
    }

    .wiki-header h1 {
        color: #2e7d32;
        margin: 0 0 10px 0;
        font-size: 2.5em;
        font-weight: 700;
    }

    .tagline {
        color: #66bb6a;
        font-size: 1.3em;
        font-style: italic;
        margin: 0 0 20px 0;
    }

    .description {
        color: #555;
        line-height: 1.8;
        font-size: 1.05em;
    }

    .wiki-categories,
    .wiki-recent,
    .wiki-popular-tags {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.1);
    }

    .wiki-categories h2,
    .wiki-recent h2,
    .wiki-popular-tags h2 {
        color: #2e7d32;
        margin: 0 0 20px 0;
        font-size: 1.8em;
        font-weight: 600;
    }

    .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
    }

    .category-card {
        background: #f9f9f9;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .category-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        border-color: #4caf50;
    }

    .category-icon {
        font-size: 2em;
        margin-bottom: 10px;
    }

    .category-name {
        color: #2e7d32;
        font-weight: 600;
        font-size: 1.1em;
        margin-bottom: 5px;
    }

    .category-count {
        color: #666;
        font-size: 0.9em;
    }

    .page-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .page-list li {
        padding: 15px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .page-list li:hover {
        background: #f5f5f5;
    }

    .page-list li:last-child {
        border-bottom: none;
    }

    .page-title {
        color: #2e7d32;
        font-weight: 600;
        font-size: 1.1em;
        margin-bottom: 5px;
    }

    .page-meta {
        color: #999;
        font-size: 0.9em;
    }

    .tag-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .tag {
        background: #e8f5e9;
        color: #2e7d32;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9em;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 2px solid transparent;
    }

    .tag:hover {
        background: #4caf50;
        color: white;
        border-color: #2e7d32;
    }

    .tag-count {
        background: rgba(255, 255, 255, 0.5);
        padding: 2px 8px;
        border-radius: 10px;
        margin-left: 5px;
        font-size: 0.85em;
    }
</style>

@section Scripts {
    <script>
        // Fetch and display categories
        fetch('/api/WikiCategory')
            .then(response => response.json())
            .then(categories => {
                const container = document.getElementById('categories-container');
                if (categories.length === 0) {
                    container.innerHTML = '<p>No categories yet. Be the first to create one!</p>';
                } else {
                    container.innerHTML = categories.map(cat => `
                        <div class="category-card" onclick="window.location.href='/api/WikiPage/category/${cat.id}'">
                            <div class="category-icon">${cat.icon || 'üìÅ'}</div>
                            <div class="category-name">${cat.name}</div>
                            <div class="category-count">${cat.pageCount} pages</div>
                        </div>
                    `).join('');
                }
            })
            .catch(error => {
                console.error('Error fetching categories:', error);
                document.getElementById('categories-container').innerHTML = 
                    '<p>Error loading categories. Please try again later.</p>';
            });

        // Fetch and display recent pages
        fetch('/api/WikiPage/recent?count=5')
            .then(response => response.json())
            .then(pages => {
                const container = document.getElementById('recent-pages-container');
                if (pages.length === 0) {
                    container.innerHTML = '<p>No wiki pages yet. Start by creating one!</p>';
                } else {
                    container.innerHTML = '<ul class="page-list">' + pages.map(page => `
                        <li onclick="window.location.href='/api/WikiPage/${page.id}'">
                            <div class="page-title">${page.title}</div>
                            <div class="page-meta">
                                Updated ${new Date(page.updatedDateTime).toLocaleDateString()} 
                                by ${page.lastUpdatedByUserName || page.createdByUserName} 
                                | ${page.viewCount} views
                            </div>
                        </li>
                    `).join('') + '</ul>';
                }
            })
            .catch(error => {
                console.error('Error fetching recent pages:', error);
                document.getElementById('recent-pages-container').innerHTML = 
                    '<p>Error loading recent pages. Please try again later.</p>';
            });

        // Fetch and display popular tags
        fetch('/api/WikiTag/popular?count=15')
            .then(response => response.json())
            .then(tags => {
                const container = document.getElementById('popular-tags-container');
                if (tags.length === 0) {
                    container.innerHTML = '<p>No tags yet.</p>';
                } else {
                    container.innerHTML = '<div class="tag-cloud">' + tags.map(tag => `
                        <div class="tag" onclick="window.location.href='/api/WikiPage/tag/${tag.id}'">
                            ${tag.name}
                            <span class="tag-count">${tag.usageCount}</span>
                        </div>
                    `).join('') + '</div>';
                }
            })
            .catch(error => {
                console.error('Error fetching popular tags:', error);
                document.getElementById('popular-tags-container').innerHTML = 
                    '<p>Error loading tags. Please try again later.</p>';
            });
    </script>
}
