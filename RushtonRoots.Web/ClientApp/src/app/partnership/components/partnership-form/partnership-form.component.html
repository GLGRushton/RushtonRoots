<div class="partnership-form-container">
  <form [formGroup]="partnershipForm" (ngSubmit)="onSubmit()">
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          {{ isEditMode ? 'Edit Partnership' : 'Create New Partnership' }}
        </mat-card-title>
        <mat-card-subtitle>
          {{ isEditMode ? 'Update partnership information' : 'Add a new family partnership or relationship' }}
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <!-- Partner Selection Section -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>people</mat-icon>
            Partners
          </h3>

          <div class="partner-selection">
            <!-- Person A Selection -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>First Partner *</mat-label>
              <input 
                type="text"
                matInput
                formControlName="personASearch"
                [matAutocomplete]="personAAutocomplete"
                placeholder="Search for a person...">
              <mat-icon matPrefix>person</mat-icon>
              <mat-error *ngIf="hasError('personAId', 'required')">
                First partner is required
              </mat-error>
            </mat-form-field>

            <mat-autocomplete 
              #personAAutocomplete="matAutocomplete"
              (optionSelected)="onPersonASelected($event.option.value)"
              [displayWith]="displayPerson">
              <mat-option *ngFor="let person of filteredPersonAOptions | async" [value]="person">
                <div class="person-option">
                  <img 
                    *ngIf="person.photoUrl" 
                    [src]="person.photoUrl" 
                    class="person-avatar"
                    [alt]="person.name">
                  <div *ngIf="!person.photoUrl" class="person-avatar-fallback">
                    {{ person.name.charAt(0) }}
                  </div>
                  <div class="person-details">
                    <span class="person-name">{{ person.name }}</span>
                    <span class="person-lifespan" *ngIf="person.lifeSpan">{{ person.lifeSpan }}</span>
                  </div>
                </div>
              </mat-option>
            </mat-autocomplete>

            <!-- Partnership Icon -->
            <div class="partnership-icon-separator">
              <mat-icon>favorite</mat-icon>
            </div>

            <!-- Person B Selection -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Second Partner *</mat-label>
              <input 
                type="text"
                matInput
                formControlName="personBSearch"
                [matAutocomplete]="personBAutocomplete"
                placeholder="Search for a person...">
              <mat-icon matPrefix>person</mat-icon>
              <mat-error *ngIf="hasError('personBId', 'required')">
                Second partner is required
              </mat-error>
            </mat-form-field>

            <mat-autocomplete 
              #personBAutocomplete="matAutocomplete"
              (optionSelected)="onPersonBSelected($event.option.value)"
              [displayWith]="displayPerson">
              <mat-option *ngFor="let person of filteredPersonBOptions | async" [value]="person">
                <div class="person-option">
                  <img 
                    *ngIf="person.photoUrl" 
                    [src]="person.photoUrl" 
                    class="person-avatar"
                    [alt]="person.name">
                  <div *ngIf="!person.photoUrl" class="person-avatar-fallback">
                    {{ person.name.charAt(0) }}
                  </div>
                  <div class="person-details">
                    <span class="person-name">{{ person.name }}</span>
                    <span class="person-lifespan" *ngIf="person.lifeSpan">{{ person.lifeSpan }}</span>
                  </div>
                </div>
              </mat-option>
            </mat-autocomplete>
          </div>
        </div>

        <mat-divider></mat-divider>

        <!-- Partnership Type Section -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>category</mat-icon>
            Partnership Details
          </h3>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Partnership Type *</mat-label>
            <mat-select formControlName="partnershipType">
              <mat-option *ngFor="let type of partnershipTypes" [value]="type.value">
                <div class="type-option">
                  <mat-icon>{{ type.icon }}</mat-icon>
                  <span>{{ type.display }}</span>
                </div>
              </mat-option>
            </mat-select>
            <mat-hint>Select the type of partnership</mat-hint>
          </mat-form-field>

          <!-- Selected Type Description -->
          <div class="type-description" *ngIf="partnershipForm.value.partnershipType">
            <mat-icon>info</mat-icon>
            <span>
              {{ getSelectedTypeDescription() }}
            </span>
          </div>
        </div>

        <mat-divider></mat-divider>

        <!-- Dates Section -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>event</mat-icon>
            Important Dates
          </h3>

          <div class="date-fields">
            <mat-form-field appearance="outline">
              <mat-label>Start Date</mat-label>
              <input matInput [matDatepicker]="startPicker" formControlName="startDate">
              <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
              <mat-datepicker #startPicker></mat-datepicker>
              <mat-hint>When did the partnership begin?</mat-hint>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>End Date</mat-label>
              <input matInput [matDatepicker]="endPicker" formControlName="endDate">
              <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
              <mat-datepicker #endPicker></mat-datepicker>
              <mat-hint>When did the partnership end? (Leave blank if current)</mat-hint>
            </mat-form-field>
          </div>
        </div>

        <mat-divider></mat-divider>

        <!-- Location Section -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>place</mat-icon>
            Location
          </h3>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Location</mat-label>
            <input matInput formControlName="location" placeholder="City, State, Country">
            <mat-icon matPrefix>place</mat-icon>
            <mat-hint>Where did the partnership take place?</mat-hint>
          </mat-form-field>
        </div>

        <mat-divider></mat-divider>

        <!-- Notes Section -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>notes</mat-icon>
            Additional Notes
          </h3>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Notes</mat-label>
            <textarea 
              matInput 
              formControlName="notes" 
              rows="4"
              maxlength="1000"
              placeholder="Add any additional information about this partnership..."></textarea>
            <mat-hint align="end">{{ getNotesCharCount() }} / 1000</mat-hint>
          </mat-form-field>
        </div>
      </mat-card-content>

      <mat-divider></mat-divider>

      <mat-card-actions>
        <button 
          mat-raised-button 
          color="primary" 
          type="submit"
          [disabled]="isSubmitting || partnershipForm.invalid">
          <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
          {{ isEditMode ? 'Save Changes' : 'Create Partnership' }}
        </button>

        <button 
          mat-stroked-button 
          type="button"
          (click)="onCancel()"
          [disabled]="isSubmitting">
          <mat-icon>cancel</mat-icon>
          Cancel
        </button>

        <mat-spinner *ngIf="isSubmitting" diameter="24" class="submit-spinner"></mat-spinner>
      </mat-card-actions>
    </mat-card>
  </form>
</div>
